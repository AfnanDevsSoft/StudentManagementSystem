generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Branch {
  id                      String                 @id @default(uuid()) @db.Uuid
  name                    String                 @unique
  code                    String                 @unique
  address                 String?
  city                    String?
  state                   String?
  country                 String?
  postal_code             String?
  phone                   String?
  email                   String?
  website                 String?
  principal_name          String?
  principal_email         String?
  timezone                String                 @default("UTC")
  currency                String                 @default("USD")
  is_active               Boolean                @default(true)
  created_at              DateTime               @default(now())
  updated_at              DateTime               @updatedAt
  academic_years          AcademicYear[]
  admissions_applications AdmissionApplication[]
  analytics_metrics       AnalyticsMetric[]
  audit_logs              AuditLog[]
  communication_logs      CommunicationLog[]
  courses                 Course[]
  payroll_records         PayrollRecord[]
  reports                 Report[]
  students                Student[]
  teachers                Teacher[]
  branches_users          UserBranch[]
  users                   User[]

  @@index([code])
  @@map("branches")
}

model Role {
  id          String   @id @default(uuid()) @db.Uuid
  branch_id   String?  @db.Uuid
  name        String
  description String?
  permissions Json?
  is_system   Boolean  @default(false)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  users       User[]

  @@unique([name, branch_id])
  @@map("roles")
}

model User {
  id                 String             @id @default(uuid()) @db.Uuid
  branch_id          String             @db.Uuid
  role_id            String             @db.Uuid
  username           String             @unique
  email              String             @unique
  password_hash      String
  first_name         String
  last_name          String
  phone              String?
  profile_photo      String?
  is_active          Boolean            @default(true)
  last_login         DateTime?
  login_attempts     Int                @default(0)
  locked_until       DateTime?
  created_at         DateTime           @default(now())
  updated_at         DateTime           @updatedAt
  created_by_id      String?            @db.Uuid
  updated_by_id      String?            @db.Uuid
  audit_logs         AuditLog[]
  communication_logs CommunicationLog[]
  received_messages  DirectMessage[]    @relation("received_messages")
  sent_messages      DirectMessage[]    @relation("sent_messages")
  student            Student?
  teacher            Teacher?
  user_branches      UserBranch[]
  user_roles         UserRole[]
  branch             Branch             @relation(fields: [branch_id], references: [id])
  user_created_by    User?              @relation("CreatedBy", fields: [created_by_id], references: [id])
  created_by_users   User[]             @relation("CreatedBy")
  role               Role               @relation(fields: [role_id], references: [id])
  user_updated_by    User?              @relation("UpdatedBy", fields: [updated_by_id], references: [id])
  updated_by_users   User[]             @relation("UpdatedBy")

  @@index([email])
  @@index([branch_id])
  @@map("users")
}

model UserBranch {
  user_id      String   @db.Uuid
  branch_id    String   @db.Uuid
  access_level String?
  created_at   DateTime @default(now())
  branch       Branch   @relation(fields: [branch_id], references: [id], onDelete: Cascade)
  user         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([user_id, branch_id])
  @@map("user_branches")
}

model Student {
  id                     String              @id @default(uuid()) @db.Uuid
  branch_id              String              @db.Uuid
  user_id                String?             @unique @db.Uuid
  student_code           String              @unique
  first_name             String
  last_name              String
  date_of_birth          DateTime
  gender                 String?
  blood_group            String?
  nationality            String?
  cnic                   String?
  passport_number        String?
  permanent_address      String?
  current_address        String?
  city                   String?
  postal_code            String?
  personal_phone         String?
  personal_email         String?
  admission_date         DateTime
  admission_status       String              @default("pending")
  current_grade_level_id String?             @db.Uuid
  previous_school        String?
  profile_photo          String?
  is_active              Boolean             @default(true)
  graduation_date        DateTime?
  graduation_status      String?
  created_at             DateTime            @default(now())
  updated_at             DateTime            @updatedAt
  attendance             Attendance[]
  book_loans             BookLoan[]
  communication_logs     CommunicationLog[]
  fee_payments           FeePayment[]
  grades                 Grade[]
  health_record          HealthRecord?
  medical_incidents      MedicalIncident[]
  scholarships           Scholarship[]
  enrollments            StudentEnrollment[]
  branch                 Branch              @relation(fields: [branch_id], references: [id])
  user                   User?               @relation(fields: [user_id], references: [id])
  parents                ParentGuardian[]    @relation("StudentParents")

  @@unique([branch_id, student_code])
  @@index([student_code])
  @@map("students")
}

model ParentGuardian {
  id             String             @id @default(uuid()) @db.Uuid
  first_name     String
  last_name      String
  relationship   String
  primary_phone  String
  email          String?
  occupation     String?
  organization   String?
  address        String?
  city           String?
  cnic           String?
  is_active      Boolean            @default(true)
  created_at     DateTime           @default(now())
  communications CommunicationLog[]
  students       Student[]          @relation("StudentParents")

  @@map("parents_guardians")
}

model Teacher {
  id                String              @id @default(uuid()) @db.Uuid
  branch_id         String              @db.Uuid
  user_id           String?             @unique @db.Uuid
  employee_code     String              @unique
  first_name        String
  last_name         String
  email             String
  phone             String?
  date_of_birth     DateTime?
  gender            String?
  nationality       String?
  cnic              String?
  hire_date         DateTime
  employment_type   String
  department        String?
  designation       String?
  qualification     String?
  years_experience  Int?
  office_phone      String?
  office_location   String?
  personal_address  String?
  salary_grade      String?
  is_active         Boolean             @default(true)
  employment_status String              @default("active")
  profile_photo     String?
  created_at        DateTime            @default(now())
  updated_at        DateTime            @updatedAt
  book_loans        BookLoan[]
  courses           Course[]
  grades_created    Grade[]
  leave_requests    LeaveRequest[]
  payroll_records   PayrollRecord[]
  attendance        TeacherAttendance[]
  branch            Branch              @relation(fields: [branch_id], references: [id])
  user              User?               @relation(fields: [user_id], references: [id])

  @@unique([branch_id, employee_code])
  @@index([employee_code])
  @@map("teachers")
}

model AcademicYear {
  id         String   @id @default(uuid()) @db.Uuid
  branch_id  String   @db.Uuid
  year       String
  start_date DateTime
  end_date   DateTime
  is_current Boolean  @default(false)
  created_at DateTime @default(now())
  branch     Branch   @relation(fields: [branch_id], references: [id])
  courses    Course[]
  grades     Grade[]

  @@unique([branch_id, year])
  @@map("academic_years")
}

model GradeLevel {
  id         String   @id @default(uuid()) @db.Uuid
  branch_id  String   @db.Uuid
  name       String
  code       String
  sort_order Int?
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  courses    Course[]

  @@unique([branch_id, code])
  @@map("grade_levels")
}

model Subject {
  id          String   @id @default(uuid()) @db.Uuid
  branch_id   String   @db.Uuid
  name        String
  code        String
  description String?
  credits     Int?
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  courses     Course[]

  @@unique([branch_id, code])
  @@map("subjects")
}

model Course {
  id                String              @id @default(uuid()) @db.Uuid
  branch_id         String              @db.Uuid
  academic_year_id  String              @db.Uuid
  subject_id        String              @db.Uuid
  grade_level_id    String              @db.Uuid
  teacher_id        String              @db.Uuid
  course_name       String
  course_code       String              @unique
  description       String?
  max_students      Int                 @default(40)
  room_number       String?
  building          String?
  schedule          Json?
  is_active         Boolean             @default(true)
  created_at        DateTime            @default(now())
  updated_at        DateTime            @updatedAt
  attendance        Attendance[]
  announcements     ClassAnnouncement[]
  course_contents   CourseContent[]
  academic_year     AcademicYear        @relation(fields: [academic_year_id], references: [id])
  branch            Branch              @relation(fields: [branch_id], references: [id])
  grade_level       GradeLevel          @relation(fields: [grade_level_id], references: [id])
  subject           Subject             @relation(fields: [subject_id], references: [id])
  teacher           Teacher             @relation(fields: [teacher_id], references: [id])
  grades            Grade[]
  enrollments       StudentEnrollment[]
  timetable_entries TimetableEntry[]

  @@index([course_code])
  @@map("courses")
}

model StudentEnrollment {
  id              String   @id @default(uuid()) @db.Uuid
  student_id      String   @db.Uuid
  course_id       String   @db.Uuid
  enrollment_date DateTime
  status          String   @default("enrolled")
  final_grade     String?
  gpa_points      Decimal? @db.Decimal(3, 2)
  created_at      DateTime @default(now())
  course          Course   @relation(fields: [course_id], references: [id], onDelete: Cascade)
  student         Student  @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@unique([student_id, course_id])
  @@index([student_id])
  @@map("student_enrollments")
}

model Attendance {
  id          String   @id @default(uuid()) @db.Uuid
  student_id  String   @db.Uuid
  course_id   String   @db.Uuid
  date        DateTime
  status      String
  remarks     String?
  recorded_by String   @db.Uuid
  created_at  DateTime @default(now())
  course      Course   @relation(fields: [course_id], references: [id])
  student     Student  @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@unique([student_id, course_id, date])
  @@index([student_id])
  @@map("attendance")
}

model Grade {
  id                String       @id @default(uuid()) @db.Uuid
  student_id        String       @db.Uuid
  course_id         String       @db.Uuid
  academic_year_id  String       @db.Uuid
  assessment_type   String
  assessment_name   String
  score             Decimal      @db.Decimal(5, 2)
  max_score         Decimal      @default(100) @db.Decimal(5, 2)
  weight            Decimal?     @db.Decimal(5, 2)
  grade_date        DateTime
  graded_by         String       @db.Uuid
  remarks           String?
  created_at        DateTime     @default(now())
  updated_at        DateTime     @updatedAt
  academic_year     AcademicYear @relation(fields: [academic_year_id], references: [id])
  course            Course       @relation(fields: [course_id], references: [id])
  graded_by_teacher Teacher      @relation(fields: [graded_by], references: [id])
  student           Student      @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@index([student_id])
  @@map("grades")
}

model TeacherAttendance {
  id         String    @id @default(uuid()) @db.Uuid
  teacher_id String    @db.Uuid
  date       DateTime
  check_in   DateTime?
  check_out  DateTime?
  status     String
  remarks    String?
  created_at DateTime  @default(now())
  teacher    Teacher   @relation(fields: [teacher_id], references: [id], onDelete: Cascade)

  @@unique([teacher_id, date])
  @@map("teacher_attendance")
}

model PayrollRecord {
  id           String    @id @default(uuid()) @db.Uuid
  teacher_id   String    @db.Uuid
  branch_id    String    @db.Uuid
  month        Int
  year         Int
  base_salary  Decimal   @db.Decimal(10, 2)
  allowances   Decimal   @default(0) @db.Decimal(10, 2)
  gross_salary Decimal   @db.Decimal(10, 2)
  deductions   Decimal   @default(0) @db.Decimal(10, 2)
  net_salary   Decimal   @db.Decimal(10, 2)
  days_worked  Int?
  days_absent  Int?
  leave_days   Int?
  status       String    @default("draft")
  paid_date    DateTime?
  approved_by  String?   @db.Uuid
  created_at   DateTime  @default(now())
  branch       Branch    @relation(fields: [branch_id], references: [id])
  teacher      Teacher   @relation(fields: [teacher_id], references: [id])

  @@unique([teacher_id, month, year])
  @@map("payroll_records")
}

model LeaveRequest {
  id            String    @id @default(uuid()) @db.Uuid
  teacher_id    String    @db.Uuid
  leave_type    String
  start_date    DateTime
  end_date      DateTime
  days_count    Int
  reason        String
  status        String    @default("pending")
  approved_by   String?   @db.Uuid
  approval_date DateTime?
  created_at    DateTime  @default(now())
  teacher       Teacher   @relation(fields: [teacher_id], references: [id], onDelete: Cascade)

  @@map("leave_requests")
}

model AdmissionForm {
  id            String   @id @default(uuid()) @db.Uuid
  branch_id     String   @db.Uuid
  form_name     String
  form_template Json
  is_active     Boolean  @default(true)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  @@map("admission_forms")
}

model AdmissionApplication {
  id                 String    @id @default(uuid()) @db.Uuid
  branch_id          String    @db.Uuid
  application_number String    @unique
  applicant_data     Json
  applicant_email    String
  applicant_phone    String
  status             String    @default("submitted")
  application_date   DateTime
  review_notes       String?
  reviewed_by        String?   @db.Uuid
  review_date        DateTime?
  payment_status     String    @default("pending")
  created_at         DateTime  @default(now())
  updated_at         DateTime  @updatedAt
  branch             Branch    @relation(fields: [branch_id], references: [id])

  @@index([application_number])
  @@map("admission_applications")
}

model Notification {
  id                String    @id @default(uuid()) @db.Uuid
  user_id           String    @db.Uuid
  notification_type String
  subject           String
  message           String
  status            String    @default("pending")
  sent_at           DateTime?
  read_at           DateTime?
  created_at        DateTime  @default(now())

  @@map("notifications")
}

model CommunicationLog {
  id                 String          @id @default(uuid()) @db.Uuid
  branch_id          String          @db.Uuid
  student_id         String          @db.Uuid
  parent_id          String?         @db.Uuid
  created_by         String          @db.Uuid
  communication_type String
  subject            String
  message            String
  status             String          @default("pending")
  created_at         DateTime        @default(now())
  updated_at         DateTime        @updatedAt
  branch             Branch          @relation(fields: [branch_id], references: [id])
  created_by_user    User            @relation(fields: [created_by], references: [id])
  parent             ParentGuardian? @relation(fields: [parent_id], references: [id])
  student            Student         @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@index([student_id])
  @@map("communication_logs")
}

model Fee {
  id             String   @id @default(uuid()) @db.Uuid
  branch_id      String   @db.Uuid
  fee_name       String
  fee_type       String
  grade_level_id String?  @db.Uuid
  amount         Decimal  @db.Decimal(10, 2)
  due_date       DateTime
  is_active      Boolean  @default(true)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  @@unique([branch_id, fee_name, fee_type])
  @@map("fees")
}

model FeePayment {
  id             String   @id @default(uuid()) @db.Uuid
  student_id     String   @db.Uuid
  fee_id         String   @db.Uuid
  amount_paid    Decimal  @db.Decimal(10, 2)
  payment_date   DateTime
  payment_method String
  transaction_id String?
  receipt_number String?  @unique
  remarks        String?
  recorded_by    String   @db.Uuid
  status         String   @default("completed")
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
  student        Student  @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@index([student_id])
  @@map("fee_payments")
}

model Scholarship {
  id               String    @id @default(uuid()) @db.Uuid
  branch_id        String    @db.Uuid
  student_id       String    @db.Uuid
  scholarship_name String
  scholarship_type String
  amount           Decimal   @db.Decimal(10, 2)
  percentage       Decimal?  @db.Decimal(5, 2)
  start_date       DateTime
  end_date         DateTime?
  status           String    @default("active")
  approved_by      String    @db.Uuid
  approval_date    DateTime
  remarks          String?
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt
  student          Student   @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@index([student_id])
  @@map("scholarships")
}

model Announcement {
  id                String    @id @default(uuid()) @db.Uuid
  branch_id         String    @db.Uuid
  title             String
  description       String
  announcement_type String
  target_audience   String
  created_by        String    @db.Uuid
  start_date        DateTime
  end_date          DateTime?
  is_active         Boolean   @default(true)
  priority          String    @default("normal")
  attachment_url    String?
  views_count       Int       @default(0)
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt

  @@index([branch_id])
  @@map("announcements")
}

model Message {
  id             String    @id @default(uuid()) @db.Uuid
  sender_id      String    @db.Uuid
  recipient_id   String    @db.Uuid
  subject        String?
  message_body   String
  message_type   String    @default("direct")
  read_at        DateTime?
  attachment_url String?
  is_archived    Boolean   @default(false)
  created_at     DateTime  @default(now())

  @@index([recipient_id])
  @@index([sender_id])
  @@map("messages")
}

model AuditLog {
  id            String   @id @default(uuid()) @db.Uuid
  user_id       String?  @db.Uuid
  branch_id     String   @db.Uuid
  action        String
  entity_type   String
  entity_id     String?
  entity_name   String?
  changes       Json?
  ip_address    String?
  status        String   @default("success")
  error_message String?
  created_at    DateTime @default(now())
  branch        Branch   @relation(fields: [branch_id], references: [id])
  user          User?    @relation(fields: [user_id], references: [id])

  @@index([user_id])
  @@map("audit_logs")
}

model Report {
  id               String    @id @default(uuid()) @db.Uuid
  branch_id        String    @db.Uuid
  report_type      String
  title            String
  description      String?
  generated_by     String    @db.Uuid
  generated_at     DateTime  @default(now())
  report_format    String    @default("pdf")
  file_url         String?
  file_size        Int?
  filters          Json?
  date_range_start DateTime?
  date_range_end   DateTime?
  status           String    @default("completed")
  error_message    String?
  download_count   Int       @default(0)
  last_downloaded  DateTime?
  is_public        Boolean   @default(false)
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt
  branch           Branch    @relation(fields: [branch_id], references: [id])

  @@index([branch_id])
  @@index([report_type])
  @@index([generated_at])
  @@map("reports")
}

model AnalyticsMetric {
  id               String   @id @default(uuid()) @db.Uuid
  branch_id        String   @db.Uuid
  metric_type      String
  metric_name      String
  metric_value     Float
  comparison_value Float?
  trend            String?
  period_start     DateTime
  period_end       DateTime
  filters          Json?
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
  branch           Branch   @relation(fields: [branch_id], references: [id])

  @@index([branch_id])
  @@index([metric_type])
  @@index([period_start])
  @@map("analytics_metrics")
}

model CourseContent {
  id             String    @id @default(uuid()) @db.Uuid
  course_id      String    @db.Uuid
  content_type   String
  title          String
  description    String?
  content_url    String
  file_name      String?
  file_size      Int?
  file_type      String?
  duration       Int?
  sequence_order Int
  uploaded_by    String    @db.Uuid
  uploaded_at    DateTime  @default(now())
  view_count     Int       @default(0)
  last_accessed  DateTime?
  is_published   Boolean   @default(true)
  is_pinned      Boolean   @default(false)
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
  course         Course    @relation(fields: [course_id], references: [id])

  @@index([course_id])
  @@index([content_type])
  @@index([uploaded_at])
  @@map("course_contents")
}

model DirectMessage {
  id             String    @id @default(uuid()) @db.Uuid
  sender_id      String    @db.Uuid
  recipient_id   String    @db.Uuid
  subject        String?
  message_body   String
  attachment_url String?
  read_at        DateTime?
  is_deleted     Boolean   @default(false)
  deleted_at     DateTime?
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
  recipient      User      @relation("received_messages", fields: [recipient_id], references: [id])
  sender         User      @relation("sent_messages", fields: [sender_id], references: [id])

  @@index([sender_id])
  @@index([recipient_id])
  @@index([created_at])
  @@map("direct_messages")
}

model ClassAnnouncement {
  id                String    @id @default(uuid()) @db.Uuid
  course_id         String    @db.Uuid
  created_by        String    @db.Uuid
  title             String
  content           String
  priority          String    @default("normal")
  announcement_type String    @default("general")
  attachment_url    String?
  scheduled_for     DateTime?
  expires_at        DateTime?
  view_count        Int       @default(0)
  is_pinned         Boolean   @default(false)
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
  course            Course    @relation(fields: [course_id], references: [id])

  @@index([course_id])
  @@index([created_by])
  @@index([created_at])
  @@map("class_announcements")
}

model Permission {
  id              String     @id @default(uuid()) @db.Uuid
  permission_name String     @unique
  description     String?
  resource        String
  action          String
  created_at      DateTime   @default(now())
  rbac_roles      RBACRole[] @relation("PermissionToRBACRole")

  @@index([resource])
  @@map("permissions")
}

model RBACRole {
  id          String       @id @default(uuid()) @db.Uuid
  branch_id   String       @db.Uuid
  role_name   String
  description String?
  is_system   Boolean      @default(false)
  created_at  DateTime     @default(now())
  updated_at  DateTime     @updatedAt
  user_roles  UserRole[]
  permissions Permission[] @relation("PermissionToRBACRole")

  @@unique([branch_id, role_name])
  @@index([branch_id])
  @@map("rbac_roles")
}

model UserRole {
  id           String    @id @default(uuid()) @db.Uuid
  user_id      String    @db.Uuid
  rbac_role_id String    @db.Uuid
  branch_id    String    @db.Uuid
  assigned_by  String    @db.Uuid
  assigned_at  DateTime  @default(now())
  expires_at   DateTime?
  rbac_role    RBACRole  @relation(fields: [rbac_role_id], references: [id], onDelete: Cascade)
  user         User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, rbac_role_id, branch_id])
  @@index([user_id])
  @@index([branch_id])
  @@map("user_roles")
}

model NotificationNew {
  id                String    @id @default(uuid()) @db.Uuid
  user_id           String    @db.Uuid
  title             String
  message           String
  notification_type String
  data              Json?
  is_read           Boolean   @default(false)
  read_at           DateTime?
  created_at        DateTime  @default(now())

  @@index([user_id])
  @@index([created_at])
  @@map("notifications_new")
}

model NotificationPreference {
  id                   String    @id @default(uuid()) @db.Uuid
  user_id              String    @unique @db.Uuid
  email_notifications  Boolean   @default(true)
  push_notifications   Boolean   @default(true)
  sms_notifications    Boolean   @default(false)
  in_app_notifications Boolean   @default(true)
  muted_until          DateTime?
  created_at           DateTime  @default(now())
  updated_at           DateTime  @updatedAt

  @@map("notification_preferences")
}

model DeviceToken {
  id           String   @id @default(uuid()) @db.Uuid
  user_id      String   @db.Uuid
  device_token String
  device_type  String
  device_name  String?
  is_active    Boolean  @default(true)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  @@unique([user_id, device_token])
  @@index([user_id])
  @@map("device_tokens")
}

model Log {
  id        String   @id @default(uuid()) @db.Uuid
  level     String
  message   String
  metadata  Json?
  timestamp DateTime @default(now())

  @@index([level])
  @@index([timestamp])
  @@map("logs")
}

model SystemHealthCheck {
  id         String   @id @default(uuid()) @db.Uuid
  check_type String
  status     String
  details    Json?
  checked_at DateTime @default(now())

  @@index([check_type])
  @@index([checked_at])
  @@map("system_health_checks")
}

model FileExport {
  id             String   @id @default(uuid()) @db.Uuid
  user_id        String   @db.Uuid
  export_type    String
  format         String
  filters        Json?
  file_url       String?
  file_size      Int?
  status         String   @default("pending")
  error_message  String?
  download_count Int      @default(0)
  expires_at     DateTime
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  @@index([user_id])
  @@index([created_at])
  @@map("file_exports")
}

model ExportSchedule {
  id          String   @id @default(uuid()) @db.Uuid
  user_id     String   @db.Uuid
  export_type String
  format      String
  frequency   String
  filters     Json?
  recipients  String[]
  next_run_at DateTime
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  @@index([user_id])
  @@index([next_run_at])
  @@map("export_schedules")
}

model Backup {
  id              String    @id @default(uuid()) @db.Uuid
  backup_type     String
  backup_size     Int
  file_path       String?
  cloud_url       String?
  status          String    @default("completed")
  error_message   String?
  created_at      DateTime  @default(now())
  verified_at     DateTime?
  retention_until DateTime

  @@index([created_at])
  @@index([backup_type])
  @@map("backups")
}

model BackupSchedule {
  id             String    @id @default(uuid()) @db.Uuid
  backup_type    String
  frequency      String
  time_of_day    String
  retention_days Int
  is_active      Boolean   @default(true)
  next_run_at    DateTime
  last_run_at    DateTime?
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt

  @@index([next_run_at])
  @@map("backup_schedules")
}

model TimeSlot {
  id                String           @id @default(uuid()) @db.Uuid
  branch_id         String           @db.Uuid
  slot_name         String
  start_time        String
  end_time          String
  slot_type         String           @default("class")
  sort_order        Int
  is_active         Boolean          @default(true)
  created_at        DateTime         @default(now())
  timetable_entries TimetableEntry[]

  @@unique([branch_id, slot_name])
  @@map("time_slots")
}

model Room {
  id                String           @id @default(uuid()) @db.Uuid
  branch_id         String           @db.Uuid
  room_number       String
  room_name         String?
  building          String?
  floor             String?
  capacity          Int              @default(40)
  room_type         String           @default("classroom")
  facilities        Json?
  is_active         Boolean          @default(true)
  created_at        DateTime         @default(now())
  timetable_entries TimetableEntry[]

  @@unique([branch_id, room_number])
  @@map("rooms")
}

model TimetableEntry {
  id               String   @id @default(uuid()) @db.Uuid
  academic_year_id String   @db.Uuid
  course_id        String   @db.Uuid
  time_slot_id     String   @db.Uuid
  room_id          String?  @db.Uuid
  day_of_week      Int
  is_active        Boolean  @default(true)
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
  course           Course   @relation(fields: [course_id], references: [id], onDelete: Cascade)
  room             Room?    @relation(fields: [room_id], references: [id])
  time_slot        TimeSlot @relation(fields: [time_slot_id], references: [id])

  @@unique([course_id, time_slot_id, day_of_week])
  @@index([course_id])
  @@index([day_of_week])
  @@map("timetable_entries")
}

model HealthRecord {
  id                 String           @id @default(uuid()) @db.Uuid
  student_id         String           @unique @db.Uuid
  blood_group        String?
  height             Decimal?         @db.Decimal(5, 2)
  weight             Decimal?         @db.Decimal(5, 2)
  allergies          String?
  chronic_conditions String?
  medications        String?
  emergency_contact  String?
  emergency_phone    String?
  doctor_name        String?
  doctor_phone       String?
  insurance_provider String?
  insurance_number   String?
  notes              String?
  last_updated       DateTime         @default(now()) @updatedAt
  created_at         DateTime         @default(now())
  student            Student          @relation(fields: [student_id], references: [id], onDelete: Cascade)
  medical_checkups   MedicalCheckup[]
  vaccinations       Vaccination[]

  @@map("health_records")
}

model MedicalCheckup {
  id                String       @id @default(uuid()) @db.Uuid
  health_record_id  String       @db.Uuid
  checkup_date      DateTime
  height            Decimal?     @db.Decimal(5, 2)
  weight            Decimal?     @db.Decimal(5, 2)
  blood_pressure    String?
  temperature       Decimal?     @db.Decimal(4, 2)
  pulse_rate        Int?
  vision_left       String?
  vision_right      String?
  dental_checkup    Boolean      @default(false)
  doctor_name       String?
  findings          String?
  recommendations   String?
  next_checkup_date DateTime?
  created_at        DateTime     @default(now())
  health_record     HealthRecord @relation(fields: [health_record_id], references: [id], onDelete: Cascade)

  @@index([health_record_id])
  @@index([checkup_date])
  @@map("medical_checkups")
}

model Vaccination {
  id                String       @id @default(uuid()) @db.Uuid
  health_record_id  String       @db.Uuid
  vaccine_name      String
  vaccine_type      String?
  dose_number       Int?         @default(1)
  administered_date DateTime
  administered_by   String?
  batch_number      String?
  manufacturer      String?
  next_dose_date    DateTime?
  side_effects      String?
  certificate_url   String?
  created_at        DateTime     @default(now())
  health_record     HealthRecord @relation(fields: [health_record_id], references: [id], onDelete: Cascade)

  @@index([health_record_id])
  @@index([administered_date])
  @@map("vaccinations")
}

model MedicalIncident {
  id                 String    @id @default(uuid()) @db.Uuid
  student_id         String    @db.Uuid
  incident_date      DateTime  @default(now())
  incident_type      String
  severity           String
  description        String
  treatment_given    String?
  attended_by        String?
  parent_notified    Boolean   @default(false)
  hospital_visit     Boolean   @default(false)
  hospital_name      String?
  follow_up_required Boolean   @default(false)
  follow_up_notes    String?
  resolved_at        DateTime?
  created_at         DateTime  @default(now())
  updated_at         DateTime  @updatedAt
  student            Student   @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@index([student_id])
  @@index([incident_date])
  @@map("medical_incidents")
}

model Event {
  id              String   @id @default(uuid()) @db.Uuid
  branch_id       String   @db.Uuid
  title           String
  description     String?
  event_type      String
  target_audience String   @default("all")
  grade_level_id  String?  @db.Uuid
  start_date      DateTime
  end_date        DateTime
  start_time      String?
  end_time        String?
  location        String?
  organizer       String?
  is_holiday      Boolean  @default(false)
  is_recurring    Boolean  @default(false)
  recurrence_rule String?
  attachments     Json?
  created_by      String   @db.Uuid
  is_active       Boolean  @default(true)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  @@index([branch_id])
  @@index([start_date])
  @@index([event_type])
  @@map("events")
}

model Book {
  id               String     @id @default(uuid()) @db.Uuid
  branch_id        String     @db.Uuid
  isbn             String?    @unique
  title            String
  author           String
  publisher        String?
  publication_year Int?
  category         String?
  language         String     @default("English")
  total_copies     Int        @default(1)
  available_copies Int        @default(1)
  shelf_location   String?
  description      String?
  cover_image_url  String?
  price            Decimal?   @db.Decimal(10, 2)
  is_active        Boolean    @default(true)
  created_at       DateTime   @default(now())
  updated_at       DateTime   @updatedAt
  loans            BookLoan[]

  @@index([branch_id])
  @@index([isbn])
  @@index([title])
  @@map("books")
}

model BookLoan {
  id            String     @id @default(uuid()) @db.Uuid
  book_id       String     @db.Uuid
  student_id    String?    @db.Uuid
  teacher_id    String?    @db.Uuid
  borrower_type String
  issue_date    DateTime   @default(now())
  due_date      DateTime
  return_date   DateTime?
  status        String     @default("active")
  renewed_count Int        @default(0)
  issued_by     String     @db.Uuid
  returned_to   String?    @db.Uuid
  notes         String?
  created_at    DateTime   @default(now())
  updated_at    DateTime   @updatedAt
  fines         BookFine[]
  book          Book       @relation(fields: [book_id], references: [id])
  student       Student?   @relation(fields: [student_id], references: [id])
  teacher       Teacher?   @relation(fields: [teacher_id], references: [id])

  @@index([book_id])
  @@index([student_id])
  @@index([teacher_id])
  @@index([status])
  @@map("book_loans")
}

model BookFine {
  id             String    @id @default(uuid()) @db.Uuid
  loan_id        String    @db.Uuid
  fine_amount    Decimal   @db.Decimal(10, 2)
  days_overdue   Int
  paid_amount    Decimal   @default(0) @db.Decimal(10, 2)
  payment_status String    @default("unpaid")
  payment_date   DateTime?
  payment_method String?
  waived         Boolean   @default(false)
  waived_by      String?   @db.Uuid
  waived_reason  String?
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
  loan           BookLoan  @relation(fields: [loan_id], references: [id])

  @@index([loan_id])
  @@index([payment_status])
  @@map("book_fines")
}
